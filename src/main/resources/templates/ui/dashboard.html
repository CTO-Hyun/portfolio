<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Portfolio Backend Playground</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f7f8fa; }
        pre { background: #0f172a; color: #f8fafc; padding: 1rem; border-radius: .5rem; max-height: 320px; overflow: auto; }
        .section-title { font-size: 1.1rem; font-weight: 600; text-transform: uppercase; letter-spacing: .05em; }
        .card { box-shadow: 0 .125rem .25rem rgba(15, 23, 42, .08); }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-4 gap-2">
        <div>
            <h1 class="fw-bold">테스트 콘솔</h1>
            <p class="text-muted mb-0">JWT 인증 + 주문/재고/Kafka 파이프라인을 프론트 없이 빠르게 검증합니다.</p>
        </div>
        <div class="alert alert-info mb-0">
            기본 관리자: <strong>admin@example.com / Admin!234</strong><br>
            local 프로필에서만 자동 생성됩니다.
        </div>
    </div>

    <div id="alertArea" class="mb-3" aria-live="assertive" aria-atomic="true"></div>

    <div class="row g-3 mb-4">
        <div class="col-lg-4">
            <div class="card h-100">
                <div class="card-body">
                    <h2 class="section-title">1. 회원가입</h2>
                    <form id="registerForm" class="vstack gap-2 mt-3">
                        <input type="text" class="form-control" name="name" placeholder="이름" required>
                        <input type="email" class="form-control" name="email" placeholder="이메일" required>
                        <input type="password" class="form-control" name="password" placeholder="비밀번호" required>
                        <button class="btn btn-primary w-100" type="submit">회원가입 후 자동 로그인</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card h-100">
                <div class="card-body">
                    <h2 class="section-title">2. 로그인</h2>
                    <form id="loginForm" class="vstack gap-2 mt-3">
                        <input type="email" class="form-control" name="email" placeholder="이메일" required>
                        <input type="password" class="form-control" name="password" placeholder="비밀번호" required>
                        <button class="btn btn-success w-100" type="submit">JWT 로그인</button>
                    </form>
                    <div class="mt-3 small text-muted">로그인하면 Authorization 헤더가 자동으로 주입됩니다.</div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card h-100">
                <div class="card-body">
                    <h2 class="section-title">3. 인증 상태</h2>
                    <p class="mb-1">현재 토큰: <span class="badge bg-secondary" id="authStatusBadge">게스트</span></p>
                    <p class="mb-1">역할: <span class="badge bg-light text-dark" id="roleBadge">-</span></p>
                    <label class="form-label mt-2">Authorization 헤더 프리뷰</label>
                    <textarea class="form-control" rows="4" id="tokenPreview" readonly placeholder="Bearer ..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <h2 class="section-title">상품 / 재고</h2>
            <div class="row g-3 align-items-end mt-1">
                <div class="col-md-3">
                    <button class="btn btn-outline-primary w-100" id="loadProductsBtn">상품 목록 새로고침</button>
                </div>
                <div class="col-md-9 small text-muted">관리자 계정으로 로그인하면 상품 생성/재고 조정 폼이 활성화됩니다.</div>
            </div>
            <div class="table-responsive mt-3">
                <table class="table table-sm align-middle" id="productsTable">
                    <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>SKU</th>
                        <th>이름</th>
                        <th>가격</th>
                        <th>재고</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr><td colspan="5" class="text-center text-muted">데이터 없음</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="row g-3 mt-3" data-admin-only>
                <div class="col-lg-6">
                    <h3 class="fs-6">상품 생성</h3>
                    <form id="productForm" class="row g-2">
                        <div class="col-md-6"><input class="form-control" name="sku" placeholder="SKU"></div>
                        <div class="col-md-6"><input class="form-control" name="name" placeholder="이름"></div>
                        <div class="col-12"><input class="form-control" name="description" placeholder="설명"></div>
                        <div class="col-md-6"><input class="form-control" name="price" placeholder="가격 (예: 19900)"></div>
                        <div class="col-md-6"><input class="form-control" name="quantity" placeholder="초기 재고"></div>
                        <div class="col-12"><button class="btn btn-primary w-100" type="submit">상품 생성</button></div>
                    </form>
                </div>
                <div class="col-lg-6">
                    <h3 class="fs-6">재고 조정</h3>
                    <form id="stockForm" class="row g-2">
                        <div class="col-md-6"><input class="form-control" name="productId" placeholder="상품 ID"></div>
                        <div class="col-md-6"><input class="form-control" name="delta" placeholder="증감 수량 (+/-)"></div>
                        <div class="col-12"><button class="btn btn-warning w-100" type="submit">재고 반영</button></div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <h2 class="section-title mb-0">주문</h2>
                <span class="text-muted small">※ Idempotency-Key로 중복 안전성 테스트 가능</span>
            </div>
            <div class="row g-3 mt-1">
                <div class="col-lg-6">
                    <form id="orderForm" class="vstack gap-2">
                        <input class="form-control" name="productId" placeholder="상품 ID" required>
                        <input class="form-control" name="quantity" placeholder="수량" required>
                        <div class="input-group">
                            <input class="form-control" name="idempotencyKey" id="orderIdKey" placeholder="Idempotency-Key" required>
                            <button class="btn btn-outline-secondary" id="regenKeyBtn" type="button">재발급</button>
                        </div>
                        <button class="btn btn-success" type="submit">주문 생성</button>
                    </form>
                </div>
                <div class="col-lg-6">
                    <button class="btn btn-outline-dark mb-2" id="loadOrdersBtn">내 주문 조회</button>
                    <div class="table-responsive" style="max-height: 280px; overflow:auto;">
                        <table class="table table-sm" id="ordersTable">
                            <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>상태</th>
                                <th>총액</th>
                                <th>Idempotency-Key</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr><td colspan="4" class="text-center text-muted">데이터 없음</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h2 class="section-title">응답 로그</h2>
            <p class="text-muted mb-2">최근 API 응답이 JSON 포맷으로 출력됩니다.</p>
            <pre id="logOutput">{ "hint": "여기에서 API 응답을 확인하세요" }</pre>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/ui.js"></script>
</body>
</html>
